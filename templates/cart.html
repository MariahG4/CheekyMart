<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheekyMart</title>
    <link rel="logo" type="image/x-icon" href="static/images/logo.jpg">
    <link href="{{ url_for('static', filename='homestyle.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='cart.css') }}" rel="stylesheet">
    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        function displayCart() {
            // Retrieve the cart from localStorage
            /* You can uncomment the remove buttons to see the remove functionality, it updates the total but will not remove items one by one 
            so it is still a work in progress.*/
            const cartContainer = document.getElementById('cart-items');
            const totalCont = document.querySelector('.total');
            const clearButton = document.getElementById('clear');

            if (cart.length === 0) {
                cartContainer.innerHTML = "<p>Your cart is empty!</p>";
                return;
            }

            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.innerHTML = `<p>${item.name} $${item.price}</p>`;
                //const removeButton = document.createElement('button');
                //removeButton.textContent = "Remove Item";
                cartContainer.appendChild(itemElement);
                //cartContainer.appendChild(removeButton);
                /*
                removeButton.onclick = () => {
                    removeFromCart(item.name);
                    updateTotal();
                    localStorage.removeItem(item);
                }
                */
            });

            cartContainer.appendChild(clearButton);
            clearButton.onclick = () => {
                cart.forEach(item => {
                    cartContainer.remove(item);
                });
                cartContainer.innerHTML = `<p>Your cart is empty!</p>`;
                totalCont.innerHTML = `<p>Subtotal: $0.00</p>`;
                localStorage.clear();
            }
            updateTotal();
        }

        function updateTotal() {
            const totalElement = document.getElementById("total");
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            totalElement.textContent = total.toFixed(2);
        }
        /*
        function removeFromCart(itemName) {
            cart = cart.filter(item => item.name !== itemName);
            displayCart();
        }
            */
        window.onload = displayCart;
    </script>
</head>

<body>
    <header>
        <div class="logo">
            <img class="logo" src="static/images/logo.png" alt="logo" width="150" height="200">
        </div>
        <nav>
            <ul>
                <li><a href="home">Home</a></li>
                <li><a href="search">Search</a></li>
                <li><a href="products">Products</a></li>
                <li><a href="account">Account</a></li>
                <li><a href="cart" class="cart-button">Cart</a></li>
            </ul>
        </nav>
    </header>
    <section class="cart-container">
        <h1>Order Summary</h1>
        <div class="cart">
            <ul id="cart-items"></ul>
            <p class="total">Subtotal: $<span id="total">0.00</span></p>
            <button id="clear">Clear Cart</button>
        </div>

        <section class="customer-info">
            <h2>Customer Information</h2>
            <form id="customer-form">
                {% if is_logged_in %}
                    <label for="firstname">First Name</label>
                    <p id="firstname">{{ user.first_name }}</p>

                    <label for="lastname">Last Name</label>
                    <p id="lastname">{{ user.last_name }}</p>

                    <label for="email">Email</label>
                    <p id="email">{{ user.email }}</p>

                    <label for="phone">Phone Number</label>
                    <p id="phone">{{ user.phone }}</p>
                {% else %}
                    <label for="firstname">First Name</label>
                    <input type="text" name="first_name" id="first_name" required>

                    <label for="lastname">Last Name</label>
                    <input type="text" name="last_name" id="last_name" required>

                    <label for="email">Email</label>
                    <input type="email" name="email" id="email" required>

                    <label for="phone">Phone Number</label>
                    <input type="tel" name="phone" id="phone" required>
                {% endif %}
            </form>
        </section>

        <section class="payment-info">
            <h2>Payment Information</h2>
            <form id="payment-form">
                <label for="card-number">Card Number</label>
                <input type="text" id="card-number" name="card-number">

                <label for="security-code">Security Code</label>
                <input type="text" id="security-code" name="security-code">

                <label for="expiration-date">Expiration Date</label>
                <input type="text" id="expiration-date" name="expiration-date">

                <button type="button" onclick="">Place Order</button>
            </form>
        </section>
    </section>
</body>

</html>